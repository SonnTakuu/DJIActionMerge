# auto_merge_termux.sh

## 概要
`auto_merge_termux.sh` は、Termux 環境で MP4 ファイルを自動的に整理・結合するためのスクリプトです。このスクリプトは、指定されたソースディレクトリから MP4 ファイルを取得し、サイズに基づいてグループ化・結合を行い、指定された出力ディレクトリに保存します。

## 主な機能
- ソースディレクトリと出力ディレクトリの自動検出。
- ファイルサイズに基づくグループ化と結合。
- 進捗状況を表示するプログレスバー。
- 不要な `.LRF` ファイルの削除。
- 結合後のファイルを指定されたフォルダに保存。

## 必要条件
- Termux 環境
- `ffmpeg` がインストールされていること
- ソースディレクトリに `Fv-AutoMerge-Ready.log` ファイルが存在すること
- 出力ディレクトリに `Fv-Merge-Destination.log` ファイルが存在するか、ローカルディレクトリを使用する設定

## 使用方法
1. **スクリプトの実行**:
   ```bash
   ./auto_merge_termux.sh
   ```

2. **ソースディレクトリの検出**:
   スクリプトは `/storage` 内で `Fv-AutoMerge-Ready.log` を検索し、ソースディレクトリを自動的に設定します。

3. **出力ディレクトリの選択**:
   実行中に、ローカルディレクトリを使用するかどうかを尋ねられます。
   - `y` を入力すると、ローカルディレクトリ `/storage/emulated/0/FvOutput` が使用されます。
   - `n` を入力すると、`Fv-Merge-Destination.log` を基に出力ディレクトリを設定します。

4. **ファイルの処理**:
   - `.LRF` ファイルを削除します。
   - MP4 ファイルをサイズに基づいてグループ化し、`ffmpeg` を使用して結合します。
   - 結合されたファイルは、指定された出力ディレクトリに保存されます。

5. **進捗の確認**:
   プログレスバーが表示され、処理の進捗状況を確認できます。

## カスタマイズ
- **サイズ閾値の変更**:
  デフォルトでは、3.5GB を閾値として設定しています。この値を変更するには、以下の行を編集してください:
  ```bash
  SIZE_THRESHOLD=$((3 * 1024 * 1024 * 1024 + 500 * 1024 * 1024))
  ```

- **出力ディレクトリの変更**:
  デフォルトのローカル出力ディレクトリは `/storage/emulated/0/FvOutput` です。この値を変更するには、以下の行を編集してください:
  ```bash
  DEST_DEVICE=/storage/emulated/0/FvOutput
  ```

## 注意事項
- ソースディレクトリや出力ディレクトリが見つからない場合、スクリプトはエラーを出力して終了します。
- `ffmpeg` のインストールが必要です。以下のコマンドでインストールできます:
  ```bash
  pkg install ffmpeg
  ```

## ライセンス
このスクリプトは自由に使用・改変可能です。ただし、使用に伴ういかなる損害についても責任を負いません。

## 作者
このスクリプトは、DJI Action カメラの動画ファイルを効率的に管理するために作成されました。